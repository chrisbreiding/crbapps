$(function(){var e=$(window),i=e.width(),t=e.height(),o=60,n=200,a=100,l=function(e){var o="x"===e?i-n-40:t-a-40;return Math.floor(Math.random()*o)+40},r=function(){return"#"+function e(i){return(i+=[0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f"][Math.floor(16*Math.random())])&&6==i.length?i:e(i)}("")},s=function(){return Math.floor(Math.random()*(n-o))+o},h=["Annabel","Asher","Atticus","August","Butch","Clementine","Daisy","Dashiell","Delilah","Dexter","Dixie","Duke","Edie","Ella","Elvis","Flora","Frances","Frank","Georgia","Gus","Harper","Hazel","Homer","Hopper","Hudson","Hugo","Ike","India","Ione","Iris","Isla","Ivy","June","Kai","Kingston","Lennon","Leonora","Leopold","Levi","Lila","Lionel","Lola","Luca","Lulu","Magnus","Mamie","Matilda","Millie","Milo","Minnie","Moses","Olive","Orson","Oscar","Otis","Pearl","Piper","Poppy","Ray","Roman","Romy","Roscoe","Ruby","Rufus","Sadie","Scarlett","Sebastian","Silas","Stella","Stellan","Sullivan","Talullah","Theo","Violet","Harriet"],d=Backbone.Model.extend({validate:function(e){return e.width>n?"Fish is too wide!":e.height>a?"Fish is too tall!":void 0},initialize:function(){this.bind("error",function(e,i){console.log(i)}),this.get("height")||this.set({height:this.get("width")/2})},defaults:function(){return{x:l("x"),y:l("y"),color:r(),width:s(),name:function(){return h.length?h.splice(Math.floor(Math.random()*h.length)-1,1):"Fishy"}()}},setPosition:function(e,i){this.set({x:e,y:i})}}),u=Backbone.Collection.extend({model:d,initialize:function(){this.bind("add",function(e){new g({model:e,className:"fish"})},this)}}),c=new u,g=Backbone.View.extend({initialize:function(){this.render(),this.model.bind("change",this.updateView,this),$("#aquarium").mousemove(this,this.mousemove).mouseup(this,this.mouseup)},render:function(){return $(this.el).attr({title:this.model.get("name")}).append(_.template($("#fish").html())).appendTo("#aquarium"),this.updateView(),this},events:{"click .delete":"destroy","click .change-color":"changeColor",mousedown:"draggingStart"},updateView:function(){var e=this.model.get("color"),i=this.model.get("height"),t=i/2;$(this.el).css({backgroundColor:e,left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("width"),height:i}).find(".head-top").css({backgroundColor:e}).end().find(".mouth").css({"border-bottom-color":e}).end().find(".tail").css({"border-right-color":e,right:-1*t+3,"border-right-width":t,"border-top-width":t,"border-bottom-width":t})},destroy:function(){this.model.destroy(),$(this.el).remove()},changeColor:function(){this.model.set({color:prompt("Enter color value",this.model.get("color"))})},draggingStart:function(e){return this.dragging=!0,this.initialX=e.pageX-this.model.get("x"),this.initialY=e.pageY-this.model.get("y"),!1},mouseup:function(e){if(e.data){var i=e.data;i.dragging=!1}},mousemove:function(e){if(e.data){var i=e.data;i.dragging&&i.model.setPosition(e.pageX-i.initialX,e.pageY-i.initialY)}}}),m=Backbone.View.extend({el:"#aquarium",collection:c,initialize:function(){var o=this;this.render(),e.resize(function(){i=e.width(),t=e.height(),o.render.call(o)})},render:function(){$(this.el).css({width:i,height:t})},events:{"click #new-fish":"newFish"},newFish:function(){this.collection.add({})}});new m,c.add([{},{},{},{}])});